generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  userId           Int            @id @default(autoincrement())
  email            String         @unique
  firstName        String
  lastName         String
  hashedPassword   String
  role             String
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  charityCharityId Int?
  Distribution     Distribution[]
  donationsAsDonor Donation[]     @relation("DonorDonations")
  donationsAsStaff Donation[]     @relation("StaffDonations")

  @@map("users")
}

model Charity {
  charityId         Int                 @id @default(autoincrement())
  charityName       String
  charityEmail      String              @unique
  createdAt         DateTime            @default(now())
  updatedAt         DateTime?           @updatedAt
  charityRegNumber  String              @unique
  charityTeleNumber String              @unique
  charity_addresses charity_addresses[]
  distributions     Distribution[]

  @@map("charities")
}

model Donation {
  donationId   Int            @id @default(autoincrement())
  donationDate DateTime       @default(now())
  notes        String?
  status       String
  donorId      Int
  staffId      Int?
  items        DonationItem[]
  donor        User           @relation("DonorDonations", fields: [donorId], references: [userId])
  staff        User?          @relation("StaffDonations", fields: [staffId], references: [userId], onDelete: Restrict)

  @@index([donorId])
  @@index([staffId])
  @@map("donations")
}

model DonationItem {
  itemId         Int           @id @default(autoincrement())
  photoUrl       String
  description    String?
  status         String
  donationId     Int
  categoryId     Int
  conditionId    Int
  sizeId         Int?
  genderId       Int
  distributionId Int?
  category       Category      @relation(fields: [categoryId], references: [categoryId])
  condition      Condition     @relation(fields: [conditionId], references: [conditionId])
  distribution   Distribution? @relation(fields: [distributionId], references: [distributionId])
  donation       Donation      @relation(fields: [donationId], references: [donationId])
  gender         Gender        @relation(fields: [genderId], references: [genderId])
  size           Size?         @relation(fields: [sizeId], references: [sizeId])

  @@index([donationId])
  @@index([categoryId])
  @@index([conditionId])
  @@index([sizeId])
  @@index([genderId])
  @@index([distributionId])
  @@map("donation_items")
}

model Category {
  categoryId  Int            @id @default(autoincrement())
  category    String         @unique
  avgWeight   Decimal        @db.Decimal(10, 2)
  avgCo2Saved Decimal        @db.Decimal(10, 2)
  items       DonationItem[]
  inventories inventories[]

  @@map("categories")
}

model Condition {
  conditionId Int            @id @default(autoincrement())
  condition   String         @unique
  items       DonationItem[]
  inventories inventories[]

  @@map("conditions")
}

model Size {
  sizeId      Int            @id @default(autoincrement())
  size        String
  items       DonationItem[]
  inventories inventories[]

  @@map("size")
}

model Gender {
  genderId    Int            @id @default(autoincrement())
  gender      String         @unique
  items       DonationItem[]
  inventories inventories[]

  @@map("genders")
}

model Distribution {
  distributionId Int            @id @default(autoincrement())
  date           DateTime       @default(now())
  status         String
  notes          String?
  charityId      Int
  staffId        Int
  charity        Charity        @relation(fields: [charityId], references: [charityId])
  staff          User           @relation(fields: [staffId], references: [userId])
  Items          DonationItem[]

  @@index([charityId])
  @@index([staffId])
  @@map("distributions")
}

model charity_addresses {
  addressId Int       @id @default(autoincrement())
  charityId Int
  street    String
  postCode  String
  city      String
  country   String
  updatedAt DateTime?
  charities Charity   @relation(fields: [charityId], references: [charityId], onDelete: Cascade)

  @@index([charityId])
}

model inventories {
  inventoryId Int       @id @default(autoincrement())
  totalStock  Int       @default(0)
  updatedAt   DateTime?
  categoryId  Int
  conditionId Int
  sizeId      Int?
  genderId    Int
  categories  Category  @relation(fields: [categoryId], references: [categoryId])
  conditions  Condition @relation(fields: [conditionId], references: [conditionId])
  genders     Gender    @relation(fields: [genderId], references: [genderId])
  size        Size?     @relation(fields: [sizeId], references: [sizeId])

  @@index([categoryId])
  @@index([conditionId])
  @@index([genderId])
  @@index([sizeId])
}
